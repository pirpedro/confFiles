#!/bin/bash

MY_CONFIG_EXT=$(my config --ext-path)
source $MY_CONFIG_EXT/functions.sh

TARGET="$1"
PACKAGES_AVAILABLE=$(my config --all-pkg-path)
EXT=$(my config --default-extension)
PACKAGE_LOCATION=$(my config --pkg-path)

if empty "$TARGET"; then
    die "You need to pass a recipe name."
fi
if empty_output $(ls "$PACKAGES_AVAILABLE/*$TARGET$EXT"); then
    die "Recipe doesn't exist."
fi
ln -sf $(ls $PACKAGES_AVAILABLE/*$TARGET$EXT) $PACKAGE_LOCATION/
if [ -d $PACKAGES_AVAILABLE/extra/$TARGET ]; then
  if [ ! -d "$PACKAGE_LOCATION/extra/$TARGET" ]; then
    mkdir -p "$PACKAGE_LOCATION/extra/$TARGET"
  fi
  ln -sf "$PACKAGES_AVAILABLE/extra/$TARGET/*" "$PACKAGE_LOCATION/extra/$TARGET"
fi
